<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<script>
	(function () {
		window.nativeBridge = {
			postMessage: function (_data) {
				var bridgeName = _data.bridgeName
				var data = _data.data || {}
				var callbackId = _data.callbackId
				var responstId = _data.responstId || Math.random()

				window.JSBridge.receiveMessage({
					bridgeName,
					data:'sdvsdbrberberer',
					callbackId,
					responstId
				})
			}
		}
	})();

	(function () {
		var id = 1,
			callbacks = {},
			registerFuncs = {};

		window.JSBridge = {
			// 调用 Native
			invoke: function (bridgeName, callback, data) {
				// 判断环境，获取不同的 nativeBridge
				var thisId = id++; // 获取唯一 id
				callbacks[thisId] = callback; // 存储 Callback
				nativeBridge.postMessage({
					bridgeName: bridgeName,
					data: data || {},
					callbackId: thisId // 传到 Native 端
				});
			},
			receiveMessage: function (msg) {
				var bridgeName = msg.bridgeName
				var data = msg.data || {}
				var callbackId = msg.callbackId
				var responstId = msg.responstId
				// 具体逻辑
				// bridgeName 和 callbackId 不会同时存在
				if (callbackId) {
					if (callbacks[callbackId]) { // 找到相应句柄
						callbacks[callbackId](msg.data); // 执行调用
					}
				} else if (bridgeName) {
					if (registerFuncs[bridgeName]) { // 通过 bridgeName 找到句柄
						var ret = {}, flag = false;
						registerFuncs[bridgeName].forEach((callback) => {
							callback(data, function (r) {
								flag = true;
								ret = Object.assign(ret, r);
							});
						});
						if (flag) {
							nativeBridge.postMessage({ // 回调 Native
								responstId: responstId,
								ret: ret
							});
						}
					}
				}
			},
			register: function (bridgeName, callback) {
				if (!registerFuncs[bridgeName]) {
					registerFuncs[bridgeName] = [];
				}
				registerFuncs[bridgeName].push(callback); // 存储回调
			}
		};
	})();

	JSBridge.invoke('haha', function () {
		console.log(arguments)
	}, 'nimeide')

	JSBridge.register('abc',function (data, callback) {

	})

</script>

<div class="box">
  <div class="item item1">sc</div>
  <div class="item item2">sc</div>
  <div class="item item3">cdd</div>
</div>

</body>
</html>